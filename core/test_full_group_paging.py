#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ¸¬è©¦è…³æœ¬ 2: åŸ·è¡Œå®Œæ•´çš„ç¾¤çµ„å°‹å‘¼éç¨‹ï¼ˆImax å€‹æ¥å…¥å‘¨æœŸï¼‰

åŠŸèƒ½ï¼š
- ä½¿ç”¨ simulation æ¨¡çµ„çš„ _simulate_single_group_paging å‡½æ•¸
- åŸ·è¡Œå®Œæ•´çš„ç¾¤çµ„å°‹å‘¼éç¨‹ï¼ˆåŒ…å« Imax å€‹æ¥å…¥å‘¨æœŸï¼‰
- å±•ç¤ºæœ€çµ‚æ€§èƒ½æŒ‡æ¨™

ä½¿ç”¨æ–¹æ³•ï¼š
    python test_full_group_paging.py
"""

import sys
import os
import numpy as np

# å¾åŒç›®éŒ„çš„ simulation æ¨¡çµ„å¼•ç”¨æ ¸å¿ƒå‡½æ•¸
from simulation import simulate_group_paging_single_sample

# ============================================================================
# é…ç½®åƒæ•¸
# ============================================================================
M = 100      # è¨­å‚™ç¸½æ•¸
N = 25       # RAO æ•¸é‡
I_max = 10   # æœ€å¤§æ¥å…¥å‘¨æœŸæ•¸

print("=" * 70)
print("ã€æ¸¬è©¦ 2ã€‘åŸ·è¡Œå®Œæ•´ç¾¤çµ„å°‹å‘¼ - ä½¿ç”¨ simulate_group_paging_single_sample")
print("=" * 70)
print(f"åƒæ•¸é…ç½®:")
print(f"  - åˆå§‹è¨­å‚™æ•¸ M = {M}")
print(f"  - RAO æ•¸é‡ N = {N}")
print(f"  - æœ€å¤§æ¥å…¥å‘¨æœŸæ•¸ I_max = {I_max}")
print(f"  - è² è¼‰æ¯” M/N = {M/N:.2f}")
print("=" * 70)

# ============================================================================
# åŸ·è¡Œå®Œæ•´çš„ç¾¤çµ„å°‹å‘¼æ¨¡æ“¬ï¼ˆç›´æ¥èª¿ç”¨æ ¸å¿ƒå‡½æ•¸ï¼‰
# ============================================================================

print("\né–‹å§‹åŸ·è¡Œç¾¤çµ„å°‹å‘¼éç¨‹...")

# ç›´æ¥èª¿ç”¨ simulate_group_paging_single_sample å‡½æ•¸
# é€™å€‹å‡½æ•¸å·²ç¶“åŒ…å«äº†å®Œæ•´çš„ Imax å€‹ AC çš„å¾ªç’°é‚è¼¯
access_success_prob, mean_access_delay, collision_prob = simulate_group_paging_single_sample(M, N, I_max)

# ============================================================================
# é¡¯ç¤ºæ€§èƒ½æŒ‡æ¨™
# ============================================================================

print("\n" + "=" * 70)
print("ã€æœ€çµ‚æ€§èƒ½æŒ‡æ¨™ã€‘")
print("=" * 70)

# å…¬å¼ (8): æ¥å…¥æˆåŠŸç‡ P_S
success_count = int(access_success_prob * M)
print(f"âœ… æ¥å…¥æˆåŠŸç‡ (P_S):     {access_success_prob:.6f}  ({access_success_prob*100:.2f}%)")
print(f"   æˆåŠŸè¨­å‚™æ•¸: ç´„ {success_count}/{M}")
print(f"   å¤±æ•—è¨­å‚™æ•¸: ç´„ {M - success_count}/{M}")

# å…¬å¼ (9): å¹³å‡æ¥å…¥å»¶é² T_a
if mean_access_delay > 0:
    print(f"\nâ±ï¸  å¹³å‡æ¥å…¥å»¶é² (T_a):   {mean_access_delay:.6f}  (æ¥å…¥å‘¨æœŸ)")
else:
    print(f"\nâ±ï¸  å¹³å‡æ¥å…¥å»¶é² (T_a):   N/A (ç„¡è¨­å‚™æˆåŠŸ)")

# å…¬å¼ (10): ç¢°æ’æ¦‚ç‡ P_C
total_rao_count = I_max * N
total_collision_raos = int(collision_prob * total_rao_count)
print(f"\nâŒ ç¢°æ’æ¦‚ç‡ (P_C):       {collision_prob:.6f}  ({collision_prob*100:.2f}%)")
print(f"   ç¢°æ’ RAO ç¸½æ•¸: ç´„ {total_collision_raos}")
print(f"   ç¸½ RAO æ•¸: {total_rao_count} ({I_max} Ã— {N})")

print("=" * 70)

# ============================================================================
# èªªæ˜
# ============================================================================

print("\nã€æ ¸å¿ƒå‡½æ•¸èªªæ˜ã€‘")
print("â€¢ ä½¿ç”¨ simulate_group_paging_single_sample(M, N, I_max)")
print("â€¢ æ­¤å‡½æ•¸åœ¨å…§éƒ¨å®Œæˆäº†æ‰€æœ‰ Imax å€‹ AC çš„å¾ªç’°")
print("â€¢ è‡ªå‹•è™•ç†è¨­å‚™é‡è©¦å’Œçµ±è¨ˆè¨ˆç®—")
print("â€¢ èˆ‡ main.py ä¸­ä½¿ç”¨çš„æ˜¯åŒä¸€å€‹æ ¸å¿ƒå‡½æ•¸")
print("=" * 70)

print("\nã€æ€§èƒ½æŒ‡æ¨™èªªæ˜ã€‘")
print("â€¢ P_S (æ¥å…¥æˆåŠŸç‡): æˆåŠŸè¨­å‚™æ•¸ Ã· ç¸½è¨­å‚™æ•¸")
print("â€¢ T_a (å¹³å‡æ¥å…¥å»¶é²): æˆåŠŸè¨­å‚™å¹³å‡èŠ±è²»å¤šå°‘å€‹ AC")
print("â€¢ P_C (ç¢°æ’æ¦‚ç‡): ç¢°æ’çš„ RAO Ã· ç¸½ RAO æ•¸")
print("=" * 70)

print("\nâœ¨ æ¸¬è©¦å®Œæˆï¼")
print("ğŸ’¡ æç¤º: é‹è¡Œ 'python main.py' æŸ¥çœ‹å¤šæ¨£æœ¬çµ±è¨ˆå¹³å‡å€¼\n")
